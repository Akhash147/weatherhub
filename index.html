<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="WeatherHub - Check current weather and 5-day forecast for any city. Features geolocation, dark mode, and a helpful chatbot.">
    <meta name="keywords" content="weather, forecast, current weather, geolocation, dark mode, chatbot">
    <meta name="author" content="Akhash">
    <meta property="og:title" content="WeatherHub - Your Weather Companion">
    <meta property="og:description" content="Get current weather and 5-day forecasts for any city with WeatherHub. Features geolocation, dark mode, and a chatbot.">
    <meta property="og:image" content="https://akhash147.github.io/weatherhub/background.jpg">
    <meta property="og:url" content="https://akhash147.github.io/weatherhub">
    <meta property="og:type" content="website">
    <title data-translate="title">WeatherHub</title>
    <link rel="stylesheet" href="style.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600&display=swap" rel="stylesheet">
    <link rel="icon" type="image/png" href="favicon.png">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
    <div class="top-bar">
        <button class="dark-mode-toggle" onclick="toggleDarkMode()" title="Toggle Dark Mode" tabindex="0">
            <span class="dark-mode-icon">ЁЯМЩ</span>
        </button>
        <select id="languageSelect" onchange="changeLanguage()" tabindex="0">
            <option value="en">English</option>
            <option value="ta">Tamil</option>
            <option value="de">German</option>
            <option value="hi">Hindi</option>
        </select>
    </div>

    <div class="container">
        <h1 data-translate="heading">WeatherHub</h1>
        <div class="search-box">
            <div class="autocomplete-wrapper">
                <input type="text" id="cityInput" placeholder="Enter city name" data-translate="cityInputPlaceholder" tabindex="0" oninput="debouncedShowSuggestions()" autocomplete="off">
                <div class="suggestions" id="suggestions"></div>
            </div>
            <button onclick="getWeather()" data-translate="getWeatherBtn" tabindex="0">Get Weather</button>
            <button onclick="getWeatherByLocation()" class="geo-button" title="Get weather for your location" data-translate="useMyLocationBtn" tabindex="0">
                <span>ЁЯУН</span> <span data-translate="useMyLocationText">Use My Location</span>
            </button>
        </div>
        <div class="error" id="error" data-translate="error"></div>
        <div class="loading" id="loading" data-translate="loading">Loading...</div>
        <div class="weather-alert" id="weatherAlert"></div>
        <div class="weather-info" id="weatherInfo">
            <div class="weather-header">
                <h2 id="cityName"></h2>
                <img id="weatherIcon" src="" alt="Weather Icon">
            </div>
            <div class="weather-details">
                <p id="temperature"><span class="icon">ЁЯМбя╕П</span> <span data-translate="temperatureLabel">Temperature</span>: <span id="tempValue"></span></p>
                <p id="description"></p>
                <p id="humidity"><span class="icon">ЁЯТз</span> <span data-translate="humidityLabel">Humidity</span>: <span id="humidityValue"></span></p>
                <p id="wind"><span class="icon">ЁЯТи</span> <span data-translate="windLabel">Wind Speed</span>: <span id="windValue"></span></p>
            </div>
            <div class="forecast" id="forecast">
                <h3 data-translate="forecastHeading">5-Day Forecast</h3>
                <div class="forecast-container" id="forecastContainer"></div>
            </div>
            <div class="chart-container">
                <h3 data-translate="chartTitle">Temperature Trend (5 Days)</h3>
                <canvas id="tempChart"></canvas>
            </div>
        </div>
    </div>

    <div class="chatbot-container">
        <div class="chatbot-toggle" onclick="toggleChatbot()" tabindex="0">
            <span>ЁЯТм</span> <span data-translate="chatSupport">Chat Support</span>
        </div>
        <div class="chatbot-window" id="chatbotWindow">
            <div class="chatbot-header">
                <h3 data-translate="chatbotHeader">WeatherBot</h3>
                <button onclick="toggleChatbot()" tabindex="0">тЬЦ</button>
            </div>
            <div class="chatbot-messages" id="chatbotMessages">
                <div class="message bot-message" data-translate="chatbotWelcome">Hello! I'm WeatherBot. How can I help you today? Type "help" for assistance.</div>
            </div>
            <div class="chatbot-input">
                <input type="text" id="chatbotInput" placeholder="Type your message..." data-translate="chatbotInputPlaceholder" onkeypress="if(event.key === 'Enter') sendMessage()" tabindex="0">
                <button onclick="sendMessage()" data-translate="chatbotSendBtn" tabindex="0">Send</button>
            </div>
        </div>
    </div>

    <script>
        let tempChart = null;
        let cities = [];
        let currentLanguage = 'en';

        // Translation object
        const translations = {
            en: {
                title: "WeatherHub",
                heading: "WeatherHub",
                cityInputPlaceholder: "Enter city name",
                getWeatherBtn: "Get Weather",
                useMyLocationBtn: "Get weather for your location", // For title attribute
                useMyLocationText: "Use My Location",
                error: "",
                loading: "Loading...",
                temperatureLabel: "Temperature",
                humidityLabel: "Humidity",
                windLabel: "Wind Speed",
                forecastHeading: "5-Day Forecast",
                chartTitle: "Temperature Trend (5 Days)",
                chatSupport: "Chat Support",
                chatbotHeader: "WeatherBot",
                chatbotWelcome: "Hello! I'm WeatherBot. How can I help you today? Type 'help' for assistance.",
                chatbotInputPlaceholder: "Type your message...",
                chatbotSendBtn: "Send",
                // Chatbot responses
                chatbotHelp: "To use WeatherHub, start typing a city name in the search bar to see suggestions, then click 'Get Weather' or press Enter. You can also click 'Use My Location' to get weather for your current location. The app shows current weather, a 5-day forecast, and a temperature trend chart. Toggle dark mode with the button in the top-right corner.",
                chatbotData: "The app displays the city name, country, temperature (┬░C), weather description, humidity (%), wind speed (m/s), a 5-day forecast, and a temperature trend chart. YouтАЩll also see alerts for extreme weather conditions.",
                chatbotFetching: "Fetching weather for {city}...",
                chatbotWeather: "The weather in {city}, {country} is {description} with a temperature of {temp}┬░C, humidity at {humidity}%, and wind speed of {wind} m/s.",
                chatbotNotFound: "Sorry, I couldnтАЩt find {city}. Did you mean one of these? {suggestions}",
                chatbotSpecifyCity: "Please specify a city (e.g., 'weather in London').",
                chatbotHello: "Hello! IтАЩm WeatherBot. I can help you use WeatherHub or fetch weather data for a city. What would you like to do?",
                chatbotTempUnit: "The temperature is displayed in Celsius (┬░C).",
                chatbotForecast: "After searching for a city, youтАЩll see a 5-day forecast below the current weather. It includes the date, temperature, and weather conditions for each day.",
                chatbotDarkMode: "You can toggle dark mode using the button in the top-right corner (ЁЯМЩ or тШАя╕П). Your preference is saved automatically.",
                chatbotMyLocation: "Click the 'Use My Location' button (ЁЯУН) to get the weather for your current location. Make sure to allow location access when prompted.",
                chatbotUnknown: "IтАЩm not sure how to help with that. Try asking 'how do I use this?', 'weather in London', or 'what data is shown?'."
            },
            ta: {
                title: "ро╡рпЖродро░рпНро╣рокрпН",
                heading: "ро╡рпЖродро░рпНро╣рокрпН",
                cityInputPlaceholder: "роироХро░родрпНродро┐ройрпН рокрпЖропро░рпИ роЙро│рпНро│ро┐роЯро╡рпБроорпН",
                getWeatherBtn: "ро╡ро╛ройро┐ро▓рпИ рокрпЖро▒рпБ",
                useMyLocationBtn: "роЙроЩрпНроХро│рпН роЗро░рпБрокрпНрокро┐роЯродрпНродро┐ро▒рпНроХро╛рой ро╡ро╛ройро┐ро▓рпИропрпИрокрпН рокрпЖро▒ро╡рпБроорпН",
                useMyLocationText: "роОройрпН роЗро░рпБрокрпНрокро┐роЯродрпНродрпИрокрпН рокропройрпНрокроЯрпБродрпНродрпБ",
                error: "",
                loading: "роПро▒рпНро▒рпБроХро┐ро▒родрпБ...",
                temperatureLabel: "ро╡рпЖрокрпНрокроиро┐ро▓рпИ",
                humidityLabel: "роИро░рокрпНрокродроорпН",
                windLabel: "роХро╛ро▒рпНро▒рпБ ро╡рпЗроХроорпН",
                forecastHeading: "5-роиро╛ро│рпН роорпБройрпНройро▒ро┐ро╡ро┐рокрпНрокрпБ",
                chartTitle: "ро╡рпЖрокрпНрокроиро┐ро▓рпИ рокрпЛроХрпНроХрпБ (5 роиро╛роЯрпНроХро│рпН)",
                chatSupport: "роЕро░роЯрпНроЯрпИ роЖродро░ро╡рпБ",
                chatbotHeader: "ро╡рпЖродро░рпНрокро╛роЯрпН",
                chatbotWelcome: "ро╡рогроХрпНроХроорпН! роиро╛ройрпН ро╡рпЖродро░рпНрокро╛роЯрпН. роЗройрпНро▒рпБ роЙроЩрпНроХро│рпБроХрпНроХрпБ роОрокрпНрокроЯро┐ роЙродро╡ роорпБроЯро┐ропрпБроорпН? роЙродро╡ро┐роХрпНроХрпБ 'help' роОрой родроЯрпНроЯроЪрпНроЪрпБ роЪрпЖропрпНропро╡рпБроорпН.",
                chatbotInputPlaceholder: "роЙроЩрпНроХро│рпН роЪрпЖропрпНродро┐ропрпИ родроЯрпНроЯроЪрпНроЪрпБ роЪрпЖропрпНропро╡рпБроорпН...",
                chatbotSendBtn: "роЕройрпБрокрпНрокрпБ",
                chatbotHelp: "ро╡рпЖродро░рпНро╣рокрпНрокрпИрокрпН рокропройрпНрокроЯрпБродрпНрод, родрпЗроЯро▓рпН рокроЯрпНроЯро┐ропро┐ро▓рпН роироХро░родрпНродро┐ройрпН рокрпЖропро░рпИродрпН родроЯрпНроЯроЪрпНроЪрпБ роЪрпЖропрпНропродрпН родрпКроЯроЩрпНроХрпБроЩрпНроХро│рпН, рокро┐ройрпНройро░рпН 'ро╡ро╛ройро┐ро▓рпИ рокрпЖро▒рпБ' роОройрпНрокродрпИроХрпН роХро┐ро│ро┐роХрпН роЪрпЖропрпНропро╡рпБроорпН роЕро▓рпНро▓родрпБ Enter роР роЕро┤рпБродрпНродро╡рпБроорпН. роЙроЩрпНроХро│рпН родро▒рпНрокрпЛродрпИроп роЗро░рпБрокрпНрокро┐роЯродрпНродро┐ро▒рпНроХро╛рой ро╡ро╛ройро┐ро▓рпИропрпИрокрпН рокрпЖро▒ 'роОройрпН роЗро░рпБрокрпНрокро┐роЯродрпНродрпИрокрпН рокропройрпНрокроЯрпБродрпНродрпБ' роОройрпНрокродрпИроХрпН роХро┐ро│ро┐роХрпН роЪрпЖропрпНропро▓ро╛роорпН. роЗроирпНрод рокропройрпНрокро╛роЯрпБ родро▒рпНрокрпЛродрпИроп ро╡ро╛ройро┐ро▓рпИ, 5-роиро╛ро│рпН роорпБройрпНройро▒ро┐ро╡ро┐рокрпНрокрпБ рооро▒рпНро▒рпБроорпН ро╡рпЖрокрпНрокроиро┐ро▓рпИ рокрпЛроХрпНроХрпБ ро╡ро┐ро│роХрпНроХрокрпНрокроЯродрпНродрпИроХрпН роХро╛роЯрпНроЯрпБроХро┐ро▒родрпБ. роорпЗро▓рпН-ро╡ро▓родрпБ роорпВро▓рпИропро┐ро▓рпН роЙро│рпНро│ рокрпКродрпНродро╛ройрпИрокрпН рокропройрпНрокроЯрпБродрпНродро┐ роЗро░рпБрогрпНроЯ рокропройрпНроорпБро▒рпИропрпИ рооро╛ро▒рпНро▒ро╡рпБроорпН.",
                chatbotData: "рокропройрпНрокро╛роЯрпБ роироХро░родрпНродро┐ройрпН рокрпЖропро░рпН, роиро╛роЯрпБ, ро╡рпЖрокрпНрокроиро┐ро▓рпИ (┬░C), ро╡ро╛ройро┐ро▓рпИ ро╡ро┐ро│роХрпНроХроорпН, роИро░рокрпНрокродроорпН (%), роХро╛ро▒рпНро▒рпБ ро╡рпЗроХроорпН (роорпА/ро╡ро┐), 5-роиро╛ро│рпН роорпБройрпНройро▒ро┐ро╡ро┐рокрпНрокрпБ рооро▒рпНро▒рпБроорпН ро╡рпЖрокрпНрокроиро┐ро▓рпИ рокрпЛроХрпНроХрпБ ро╡ро┐ро│роХрпНроХрокрпНрокроЯродрпНродрпИроХрпН роХро╛роЯрпНроЯрпБроХро┐ро▒родрпБ. родрпАро╡ро┐ро░ ро╡ро╛ройро┐ро▓рпИ роиро┐ро▓рпИроХро│рпБроХрпНроХрпБ роОроЪрпНроЪро░ро┐роХрпНроХрпИроХро│рпИропрпБроорпН роирпАроЩрпНроХро│рпН рокро╛ро░рпНрокрпНрокрпАро░рпНроХро│рпН.",
                chatbotFetching: "{city}роХрпНроХро╛рой ро╡ро╛ройро┐ро▓рпИропрпИрокрпН рокрпЖро▒рпБроХро┐ро▒родрпБ...",
                chatbotWeather: "{city}, {country} роЗро▓рпН ро╡ро╛ройро┐ро▓рпИ {description} роЖроХ роЙро│рпНро│родрпБ, ро╡рпЖрокрпНрокроиро┐ро▓рпИ {temp}┬░C, роИро░рокрпНрокродроорпН {humidity}%, рооро▒рпНро▒рпБроорпН роХро╛ро▒рпНро▒рпБ ро╡рпЗроХроорпН {wind} роорпА/ро╡ро┐.",
                chatbotNotFound: "рооройрпНройро┐роХрпНроХро╡рпБроорпН, {city} роРроХрпН роХрогрпНроЯрпБрокро┐роЯро┐роХрпНроХ роорпБроЯро┐ропро╡ро┐ро▓рпНро▓рпИ. роЗро╡ро▒рпНро▒ро┐ро▓рпН роТройрпНро▒рпИ роирпАроЩрпНроХро│рпН роХрпБро▒ро┐рокрпНрокро┐роЯрпНроЯрпАро░рпНроХро│ро╛? {suggestions}",
                chatbotSpecifyCity: "родропро╡рпБроЪрпЖропрпНродрпБ роТро░рпБ роироХро░родрпНродрпИроХрпН роХрпБро▒ро┐рокрпНрокро┐роЯро╡рпБроорпН (роО.роХро╛., 'ро▓рогрпНроЯройро┐ро▓рпН ро╡ро╛ройро┐ро▓рпИ').",
                chatbotHello: "ро╡рогроХрпНроХроорпН! роиро╛ройрпН ро╡рпЖродро░рпНрокро╛роЯрпН. ро╡рпЖродро░рпНро╣рокрпНрокрпИрокрпН рокропройрпНрокроЯрпБродрпНрод роЙроЩрпНроХро│рпБроХрпНроХрпБ роЙродро╡ро▓ро╛роорпН роЕро▓рпНро▓родрпБ роТро░рпБ роироХро░родрпНродро┐ро▒рпНроХро╛рой ро╡ро╛ройро┐ро▓рпИ родро░ро╡рпИрокрпН рокрпЖро▒ро▓ро╛роорпН. роирпАроЩрпНроХро│рпН роОройрпНрой роЪрпЖропрпНроп ро╡ро┐ро░рпБроорпНрокрпБроХро┐ро▒рпАро░рпНроХро│рпН?",
                chatbotTempUnit: "ро╡рпЖрокрпНрокроиро┐ро▓рпИ роЪрпЖро▓рпНроЪро┐ропро╕рпН (┬░C) роЗро▓рпН роХро╛роЯрпНроЯрокрпНрокроЯрпБроХро┐ро▒родрпБ.",
                chatbotForecast: "роТро░рпБ роироХро░родрпНродрпИродрпН родрпЗроЯро┐роп рокро┐ро▒роХрпБ, родро▒рпНрокрпЛродрпИроп ро╡ро╛ройро┐ро▓рпИроХрпНроХрпБ роХрпАро┤рпЗ 5-роиро╛ро│рпН роорпБройрпНройро▒ро┐ро╡ро┐рокрпНрокрпИрокрпН рокро╛ро░рпНрокрпНрокрпАро░рпНроХро│рпН. роЗродрпБ родрпЗродро┐, ро╡рпЖрокрпНрокроиро┐ро▓рпИ рооро▒рпНро▒рпБроорпН роТро╡рпНро╡рпКро░рпБ роиро╛ро│рпБроХрпНроХро╛рой ро╡ро╛ройро┐ро▓рпИ роиро┐ро▓рпИроХро│рпИ роЙро│рпНро│роЯроХрпНроХро┐ропродрпБ.",
                chatbotDarkMode: "роорпЗро▓рпН-ро╡ро▓родрпБ роорпВро▓рпИропро┐ро▓рпН роЙро│рпНро│ рокрпКродрпНродро╛ройрпИ (ЁЯМЩ роЕро▓рпНро▓родрпБ тШАя╕П) рокропройрпНрокроЯрпБродрпНродро┐ роЗро░рпБрогрпНроЯ рокропройрпНроорпБро▒рпИропрпИ рооро╛ро▒рпНро▒ро▓ро╛роорпН. роЙроЩрпНроХро│рпН ро╡ро┐ро░рпБрокрпНрокроорпН родро╛ройро╛роХро╡рпЗ роЪрпЗрооро┐роХрпНроХрокрпНрокроЯрпБроорпН.",
                chatbotMyLocation: "'роОройрпН роЗро░рпБрокрпНрокро┐роЯродрпНродрпИрокрпН рокропройрпНрокроЯрпБродрпНродрпБ' рокрпКродрпНродро╛ройрпИ (ЁЯУН) роХро┐ро│ро┐роХрпН роЪрпЖропрпНропро╡рпБроорпН, роЙроЩрпНроХро│рпН родро▒рпНрокрпЛродрпИроп роЗро░рпБрокрпНрокро┐роЯродрпНродро┐ро▒рпНроХро╛рой ро╡ро╛ройро┐ро▓рпИропрпИрокрпН рокрпЖро▒. роЕройрпБроородро┐ роХрпЗроЯрпНроХрпБроорпНрокрпЛродрпБ роЗро░рпБрокрпНрокро┐роЯ роЕрогрпБроХро▓рпИ роЕройрпБроородро┐роХрпНроХро╡рпБроорпН.",
                chatbotUnknown: "роЕродрпИ роОрокрпНрокроЯро┐ роЙродро╡рпБро╡родрпБ роОройрпНро▒рпБ роОройроХрпНроХрпБродрпН родрпЖро░ро┐ропро╡ро┐ро▓рпНро▓рпИ. 'роЗродрпИ роОрокрпНрокроЯро┐ рокропройрпНрокроЯрпБродрпНродрпБро╡родрпБ?', 'ро▓рогрпНроЯройро┐ро▓рпН ро╡ро╛ройро┐ро▓рпИ', роЕро▓рпНро▓родрпБ 'роОройрпНрой родро░ро╡рпБ роХро╛роЯрпНроЯрокрпНрокроЯрпБроХро┐ро▒родрпБ?' роОройрпНро▒рпБ роХрпЗроЯрпНроЯрпБрокрпН рокро╛ро░рпБроЩрпНроХро│рпН."
            },
            de: {
                title: "WeatherHub",
                heading: "WeatherHub",
                cityInputPlaceholder: "Stadtname eingeben",
                getWeatherBtn: "Wetter abrufen",
                useMyLocationBtn: "Wetter f├╝r Ihren Standort abrufen",
                useMyLocationText: "Meinen Standort verwenden",
                error: "",
                loading: "Laden...",
                temperatureLabel: "Temperatur",
                humidityLabel: "Luftfeuchtigkeit",
                windLabel: "Windgeschwindigkeit",
                forecastHeading: "5-Tage-Vorhersage",
                chartTitle: "Temperaturverlauf (5 Tage)",
                chatSupport: "Chat-Unterst├╝tzung",
                chatbotHeader: "WeatherBot",
                chatbotWelcome: "Hallo! Ich bin WeatherBot. Wie kann ich Ihnen heute helfen? Geben Sie 'help' ein, um Unterst├╝tzung zu erhalten.",
                chatbotInputPlaceholder: "Nachricht eingeben...",
                chatbotSendBtn: "Senden",
                chatbotHelp: "Um WeatherHub zu nutzen, beginnen Sie, einen Stadtnamen in die Suchleiste einzugeben, um Vorschl├дge zu sehen, und klicken Sie dann auf 'Wetter abrufen' oder dr├╝cken Sie Enter. Sie k├╢nnen auch auf 'Meinen Standort verwenden' klicken, um das Wetter f├╝r Ihren aktuellen Standort abzurufen. Die App zeigt das aktuelle Wetter, eine 5-Tage-Vorhersage und ein Diagramm zum Temperaturverlauf an. Wechseln Sie den Dunkelmodus mit dem Button in der oberen rechten Ecke.",
                chatbotData: "Die App zeigt den Stadtnamen, das Land, die Temperatur (┬░C), die Wetterbeschreibung, die Luftfeuchtigkeit (%), die Windgeschwindigkeit (m/s), eine 5-Tage-Vorhersage und ein Diagramm zum Temperaturverlauf an. Sie sehen auch Warnungen bei extremen Wetterbedingungen.",
                chatbotFetching: "Wetter f├╝r {city} wird abgerufen...",
                chatbotWeather: "Das Wetter in {city}, {country} ist {description} mit einer Temperatur von {temp}┬░C, einer Luftfeuchtigkeit von {humidity}% und einer Windgeschwindigkeit von {wind} m/s.",
                chatbotNotFound: "Es tut mir leid, ich konnte {city} nicht finden. Meinen Sie vielleicht eine dieser St├дdte? {suggestions}",
                chatbotSpecifyCity: "Bitte geben Sie eine Stadt an (z. B. 'Wetter in London').",
                chatbotHello: "Hallo! Ich bin WeatherBot. Ich kann Ihnen helfen, WeatherHub zu nutzen oder Wetterdaten f├╝r eine Stadt abzurufen. Was m├╢chten Sie tun?",
                chatbotTempUnit: "Die Temperatur wird in Celsius (┬░C) angezeigt.",
                chatbotForecast: "Nach der Suche nach einer Stadt sehen Sie unter dem aktuellen Wetter eine 5-Tage-Vorhersage. Diese enth├дlt das Datum, die Temperatur und die Wetterbedingungen f├╝r jeden Tag.",
                chatbotDarkMode: "Sie k├╢nnen den Dunkelmodus mit dem Button in der oberen rechten Ecke (ЁЯМЩ oder тШАя╕П) umschalten. Ihre Einstellung wird automatisch gespeichert.",
                chatbotMyLocation: "Klicken Sie auf den Button 'Meinen Standort verwenden' (ЁЯУН), um das Wetter f├╝r Ihren aktuellen Standort abzurufen. Stellen Sie sicher, dass Sie den Standortzugriff erlauben, wenn Sie dazu aufgefordert werden.",
                chatbotUnknown: "Ich bin mir nicht sicher, wie ich Ihnen helfen kann. Versuchen Sie, 'Wie benutze ich das?', 'Wetter in London' oder 'Welche Daten werden angezeigt?' zu fragen."
            },
            hi: {
                title: "рд╡реЗрджрд░рд╣рдм",
                heading: "рд╡реЗрджрд░рд╣рдм",
                cityInputPlaceholder: "рд╢рд╣рд░ рдХрд╛ рдирд╛рдо рджрд░реНрдЬ рдХрд░реЗрдВ",
                getWeatherBtn: "рдореМрд╕рдо рдкреНрд░рд╛рдкреНрдд рдХрд░реЗрдВ",
                useMyLocationBtn: "рдЕрдкрдиреЗ рд╕реНрдерд╛рди рдХреЗ рд▓рд┐рдП рдореМрд╕рдо рдкреНрд░рд╛рдкреНрдд рдХрд░реЗрдВ",
                useMyLocationText: "рдореЗрд░рд╛ рд╕реНрдерд╛рди рдЙрдкрдпреЛрдЧ рдХрд░реЗрдВ",
                error: "",
                loading: "рд▓реЛрдб рд╣реЛ рд░рд╣рд╛ рд╣реИ...",
                temperatureLabel: "рддрд╛рдкрдорд╛рди",
                humidityLabel: "рдирдореА",
                windLabel: "рд╣рд╡рд╛ рдХреА рдЧрддрд┐",
                forecastHeading: "5-рджрд┐рди рдХрд╛ рдкреВрд░реНрд╡рд╛рдиреБрдорд╛рди",
                chartTitle: "рддрд╛рдкрдорд╛рди рдкреНрд░рд╡реГрддреНрддрд┐ (5 рджрд┐рди)",
                chatSupport: "рдЪреИрдЯ рд╕рдорд░реНрдерди",
                chatbotHeader: "рд╡реЗрджрд░рдмреЙрдЯ",
                chatbotWelcome: "рдирдорд╕реНрддреЗ! рдореИрдВ рд╡реЗрджрд░рдмреЙрдЯ рд╣реВрдБред рдореИрдВ рдЖрдкрдХреА рдЖрдЬ рдХреИрд╕реЗ рдорджрдж рдХрд░ рд╕рдХрддрд╛ рд╣реВрдБ? рд╕рд╣рд╛рдпрддрд╛ рдХреЗ рд▓рд┐рдП 'help' рдЯрд╛рдЗрдк рдХрд░реЗрдВред",
                chatbotInputPlaceholder: "рдЕрдкрдирд╛ рд╕рдВрджреЗрд╢ рдЯрд╛рдЗрдк рдХрд░реЗрдВ...",
                chatbotSendBtn: "рднреЗрдЬреЗрдВ",
                chatbotHelp: "рд╡реЗрджрд░рд╣рдм рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП, рд╕рд░реНрдЪ рдмрд╛рд░ рдореЗрдВ рд╢рд╣рд░ рдХрд╛ рдирд╛рдо рдЯрд╛рдЗрдк рд╢реБрд░реВ рдХрд░реЗрдВ рддрд╛рдХрд┐ рд╕реБрдЭрд╛рд╡ рджреЗрдЦреЗрдВ, рдлрд┐рд░ 'рдореМрд╕рдо рдкреНрд░рд╛рдкреНрдд рдХрд░реЗрдВ' рдкрд░ рдХреНрд▓рд┐рдХ рдХрд░реЗрдВ рдпрд╛ Enter рджрдмрд╛рдПрдВред рдЖрдк рдЕрдкрдиреЗ рд╡рд░реНрддрдорд╛рди рд╕реНрдерд╛рди рдХреЗ рд▓рд┐рдП рдореМрд╕рдо рдкреНрд░рд╛рдкреНрдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП 'рдореЗрд░рд╛ рд╕реНрдерд╛рди рдЙрдкрдпреЛрдЧ рдХрд░реЗрдВ' рдкрд░ рднреА рдХреНрд▓рд┐рдХ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред рдпрд╣ рдРрдк рд╡рд░реНрддрдорд╛рди рдореМрд╕рдо, 5-рджрд┐рди рдХрд╛ рдкреВрд░реНрд╡рд╛рдиреБрдорд╛рди рдФрд░ рддрд╛рдкрдорд╛рди рдкреНрд░рд╡реГрддреНрддрд┐ рдЪрд╛рд░реНрдЯ рджрд┐рдЦрд╛рддрд╛ рд╣реИред рдКрдкрд░реА-рджрд╛рдПрдВ рдХреЛрдиреЗ рдореЗрдВ рдмрдЯрди рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдбрд╛рд░реНрдХ рдореЛрдб рдЯреЙрдЧрд▓ рдХрд░реЗрдВред",
                chatbotData: "рдпрд╣ рдРрдк рд╢рд╣рд░ рдХрд╛ рдирд╛рдо, рджреЗрд╢, рддрд╛рдкрдорд╛рди (┬░C), рдореМрд╕рдо рд╡рд┐рд╡рд░рдг, рдирдореА (%), рд╣рд╡рд╛ рдХреА рдЧрддрд┐ (рдореА/рд╕реЗ), 5-рджрд┐рди рдХрд╛ рдкреВрд░реНрд╡рд╛рдиреБрдорд╛рди рдФрд░ рддрд╛рдкрдорд╛рди рдкреНрд░рд╡реГрддреНрддрд┐ рдЪрд╛рд░реНрдЯ рджрд┐рдЦрд╛рддрд╛ рд╣реИред рдЖрдкрдХреЛ рдЪрд░рдо рдореМрд╕рдо рд╕реНрдерд┐рддрд┐рдпреЛрдВ рдХреЗ рд▓рд┐рдП рдЕрд▓рд░реНрдЯ рднреА рджрд┐рдЦрд╛рдИ рджреЗрдВрдЧреЗред",
                chatbotFetching: "{city} рдХреЗ рд▓рд┐рдП рдореМрд╕рдо рдкреНрд░рд╛рдкреНрдд рдХрд░ рд░рд╣рд╛ рд╣реИ...",
                chatbotWeather: "{city}, {country} рдореЗрдВ рдореМрд╕рдо {description} рд╣реИ, рддрд╛рдкрдорд╛рди {temp}┬░C, рдирдореА {humidity}% рдФрд░ рд╣рд╡рд╛ рдХреА рдЧрддрд┐ {wind} рдореА/рд╕реЗ рд╣реИред",
                chatbotNotFound: "рдореБрдЭреЗ рдЦреЗрдж рд╣реИ, рдореИрдВ {city} рдирд╣реАрдВ рдвреВрдВрдв рд╕рдХрд╛ред рдХреНрдпрд╛ рдЖрдк рдЗрдирдореЗрдВ рд╕реЗ рдХрд┐рд╕реА рдХрд╛ рдорддрд▓рдм рд▓реЗ рд░рд╣реЗ рдереЗ? {suggestions}",
                chatbotSpecifyCity: "рдХреГрдкрдпрд╛ рдПрдХ рд╢рд╣рд░ рдирд┐рд░реНрджрд┐рд╖реНрдЯ рдХрд░реЗрдВ (рдЙрджрд╛рд╣рд░рдг рдХреЗ рд▓рд┐рдП, 'рд▓рдВрджрди рдореЗрдВ рдореМрд╕рдо')ред",
                chatbotHello: "рдирдорд╕реНрддреЗ! рдореИрдВ рд╡реЗрджрд░рдмреЙрдЯ рд╣реВрдБред рдореИрдВ рдЖрдкрдХреЛ рд╡реЗрджрд░рд╣рдм рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдиреЗ рдореЗрдВ рдорджрдж рдХрд░ рд╕рдХрддрд╛ рд╣реВрдБ рдпрд╛ рдХрд┐рд╕реА рд╢рд╣рд░ рдХреЗ рд▓рд┐рдП рдореМрд╕рдо рдбреЗрдЯрд╛ рдкреНрд░рд╛рдкреНрдд рдХрд░ рд╕рдХрддрд╛ рд╣реВрдБред рдЖрдк рдХреНрдпрд╛ рдХрд░рдирд╛ рдЪрд╛рд╣рддреЗ рд╣реИрдВ?",
                chatbotTempUnit: "рддрд╛рдкрдорд╛рди рд╕реЗрд▓реНрд╕рд┐рдпрд╕ (┬░C) рдореЗрдВ рдкреНрд░рджрд░реНрд╢рд┐рдд рд╣реЛрддрд╛ рд╣реИред",
                chatbotForecast: "рдХрд┐рд╕реА рд╢рд╣рд░ рдХреА рдЦреЛрдЬ рдХрд░рдиреЗ рдХреЗ рдмрд╛рдж, рдЖрдкрдХреЛ рд╡рд░реНрддрдорд╛рди рдореМрд╕рдо рдХреЗ рдиреАрдЪреЗ 5-рджрд┐рди рдХрд╛ рдкреВрд░реНрд╡рд╛рдиреБрдорд╛рди рджрд┐рдЦрд╛рдИ рджреЗрдЧрд╛ред рдЗрд╕рдореЗрдВ рддрд╛рд░реАрдЦ, рддрд╛рдкрдорд╛рди рдФрд░ рдкреНрд░рддреНрдпреЗрдХ рджрд┐рди рдХреЗ рд▓рд┐рдП рдореМрд╕рдо рдХреА рд╕реНрдерд┐рддрд┐ рд╢рд╛рдорд┐рд▓ рд╣реЛрддреА рд╣реИред",
                chatbotDarkMode: "рдЖрдк рдКрдкрд░реА-рджрд╛рдПрдВ рдХреЛрдиреЗ рдореЗрдВ рдмрдЯрди (ЁЯМЩ рдпрд╛ тШАя╕П) рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдбрд╛рд░реНрдХ рдореЛрдб рдЯреЙрдЧрд▓ рдХрд░ рд╕рдХрддреЗ рд╣реИрдВред рдЖрдкрдХреА рдкреНрд░рд╛рдердорд┐рдХрддрд╛ рд╕реНрд╡рдЪрд╛рд▓рд┐рдд рд░реВрдк рд╕реЗ рд╕рд╣реЗрдЬреА рдЬрд╛рддреА рд╣реИред",
                chatbotMyLocation: "'рдореЗрд░рд╛ рд╕реНрдерд╛рди рдЙрдкрдпреЛрдЧ рдХрд░реЗрдВ' рдмрдЯрди (ЁЯУН) рдкрд░ рдХреНрд▓рд┐рдХ рдХрд░реЗрдВ, рдЕрдкрдиреЗ рд╡рд░реНрддрдорд╛рди рд╕реНрдерд╛рди рдХреЗ рд▓рд┐рдП рдореМрд╕рдо рдкреНрд░рд╛рдкреНрдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдПред рд╕реБрдирд┐рд╢реНрдЪрд┐рдд рдХрд░реЗрдВ рдХрд┐ рдЬрдм рдкреВрдЫрд╛ рдЬрд╛рдП рддреЛ рд╕реНрдерд╛рди рдкрд╣реБрдБрдЪ рдХреА рдЕрдиреБрдорддрд┐ рджреЗрдВред",
                chatbotUnknown: "рдореБрдЭреЗ рд╕рдордЭ рдирд╣реАрдВ рдЖ рд░рд╣рд╛ рдХрд┐ рдЙрд╕рдореЗрдВ рдХреИрд╕реЗ рдорджрдж рдХрд░рдиреА рд╣реИред 'рдЗрд╕реЗ рдХреИрд╕реЗ рдЙрдкрдпреЛрдЧ рдХрд░реЗрдВ?', 'рд▓рдВрджрди рдореЗрдВ рдореМрд╕рдо', рдпрд╛ 'рдХреНрдпрд╛ рдбреЗрдЯрд╛ рджрд┐рдЦрд╛рдпрд╛ рдЧрдпрд╛ рд╣реИ?' рдкреВрдЫрдиреЗ рдХреА рдХреЛрд╢рд┐рд╢ рдХрд░реЗрдВред"
            }
        };

        // Fallback list of cities
        const fallbackCities = [
            "London", "Paris", "New York", "Tokyo", "Mumbai", "Sydney",
            "Toronto", "Berlin", "Rome", "Moscow", "Dubai", "Singapore",
            "Los Angeles", "Chicago", "Miami", "Bangkok", "Seoul", "Beijing",
            "Cape Town", "Rio de Janeiro", "Amsterdam", "Vienna", "Stockholm",
            "Delhi", "Kolkata", "Chennai", "Bangalore", "Hyderabad",
            "San Francisco", "Boston", "Seattle", "Washington", "Houston",
            "Vancouver", "Montreal", "Mexico City", "Sao Paulo", "Buenos Aires",
            "Lima", "Bogota", "Santiago", "Caracas", "Quito",
            "Madrid", "Barcelona", "Lisbon", "Dublin", "Oslo",
            "Helsinki", "Copenhagen", "Prague", "Budapest", "Warsaw",
            "Athens", "Istanbul", "Kyiv", "Bucharest", "Belgrade",
            "Shanghai", "Hong Kong", "Jakarta", "Manila", "Kuala Lumpur",
            "Ho Chi Minh City", "Hanoi", "Taipei", "Dhaka", "Karachi",
            "Lahore", "Islamabad", "Colombo", "Kathmandu", "Yangon",
            "Cairo", "Lagos", "Nairobi", "Johannesburg", "Accra",
            "Algiers", "Casablanca", "Tunis", "Addis Ababa", "Dar es Salaam",
            "Sydney", "Melbourne", "Brisbane", "Perth", "Auckland",
            "Wellington", "Christchurch", "Honolulu", "Suva", "Port Moresby",
            "Riyadh", "Jeddah", "Doha", "Kuwait City", "Abu Dhabi",
            "Amman", "Beirut", "Tehran", "Baghdad", "Ankara"
        ];

        async function loadCities() {
            const storedCities = localStorage.getItem('cityList');
            if (storedCities) {
                cities = JSON.parse(storedCities);
                return;
            }

            try {
                const response = await fetch('https://raw.githubusercontent.com/lutangar/cities.json/master/cities.json');
                if (!response.ok) throw new Error('Failed to fetch city list.');
                
                const data = await response.json();
                cities = data.map(city => city.name).filter(name => name);
                cities = [...new Set(cities)];
                cities.sort();
                localStorage.setItem('cityList', JSON.stringify(cities));
            } catch (error) {
                console.error('Error loading cities:', error);
                cities = fallbackCities;
            }
        }

        function changeLanguage() {
            const lang = document.getElementById('languageSelect').value;
            currentLanguage = lang;
            localStorage.setItem('language', lang);

            // Update HTML lang attribute
            document.documentElement.lang = lang;

            // Update all elements with data-translate attributes
            document.querySelectorAll('[data-translate]').forEach(element => {
                const key = element.getAttribute('data-translate');
                if (key === 'error' && element.textContent && element.textContent !== translations[lang][key]) {
                    return; // Skip updating error message if it's already set
                }
                if (translations[lang][key]) {
                    if (element.tagName === 'INPUT' && element.hasAttribute('placeholder')) {
                        element.placeholder = translations[lang][key];
                    } else if (element.tagName === 'BUTTON' || element.tagName === 'SELECT') {
                        element.setAttribute('title', translations[lang][key]);
                    } else {
                        element.textContent = translations[lang][key];
                    }
                }
            });

            // Update chart title if it exists
            if (tempChart) {
                tempChart.options.plugins.title.text = translations[lang].chartTitle;
                tempChart.update();
            }

            // Reset chatbot welcome message
            const chatbotMessages = document.getElementById('chatbotMessages');
            chatbotMessages.innerHTML = `<div class="message bot-message" data-translate="chatbotWelcome">${translations[lang].chatbotWelcome}</div>`;
        }

        function debounce(func, delay) {
            let timeoutId;
            return function (...args) {
                clearTimeout(timeoutId);
                timeoutId = setTimeout(() => func.apply(this, args), delay);
            };
        }

        function showSuggestions() {
            const input = document.getElementById('cityInput').value.trim().toLowerCase();
            const suggestionsContainer = document.getElementById('suggestions');
            suggestionsContainer.innerHTML = '';

            if (!input) {
                suggestionsContainer.style.display = 'none';
                return;
            }

            const filteredCities = cities.filter(city => city.toLowerCase().startsWith(input));
            const limitedCities = filteredCities.slice(0, 10);

            if (limitedCities.length === 0) {
                suggestionsContainer.style.display = 'none';
                return;
            }

            limitedCities.forEach(city => {
                const suggestionItem = document.createElement('div');
                suggestionItem.classList.add('suggestion-item');
                suggestionItem.textContent = city;
                suggestionItem.onclick = () => {
                    document.getElementById('cityInput').value = city;
                    suggestionsContainer.innerHTML = '';
                    suggestionsContainer.style.display = 'none';
                    getWeather();
                };
                suggestionsContainer.appendChild(suggestionItem);
            });

            suggestionsContainer.style.display = 'block';
        }

        const debouncedShowSuggestions = debounce(showSuggestions, 300);

        document.addEventListener('click', (e) => {
            const suggestionsContainer = document.getElementById('suggestions');
            const cityInput = document.getElementById('cityInput');
            if (!cityInput.contains(e.target) && !suggestionsContainer.contains(e.target)) {
                suggestionsContainer.style.display = 'none';
            }
        });

        window.onload = async () => {
            await loadCities();
            
            // Load language preference
            const savedLang = localStorage.getItem('language') || 'en';
            document.getElementById('languageSelect').value = savedLang;
            changeLanguage();

            // Load dark mode preference
            if (localStorage.getItem('darkMode') === 'enabled') {
                document.body.classList.add('dark-mode');
                document.querySelector('.dark-mode-icon').textContent = 'тШАя╕П';
            }
        };

        function toggleDarkMode() {
            document.body.classList.toggle('dark-mode');
            const isDarkMode = document.body.classList.contains('dark-mode');
            document.querySelector('.dark-mode-icon').textContent = isDarkMode ? 'тШАя╕П' : 'ЁЯМЩ';
            localStorage.setItem('darkMode', isDarkMode ? 'enabled' : 'disabled');
            updateChartTheme();
        }

        async function getWeather(city = null, lat = null, lon = null) {
            const cityInput = city || document.getElementById('cityInput').value.trim();
            const apiKey = 'bd5e378503939ddaee76f12ad7a97608';
            let url = lat && lon 
                ? `https://api.openweathermap.org/data/2.5/weather?lat=${lat}&lon=${lon}&appid=${apiKey}&units=metric`
                : `https://api.openweathermap.org/data/2.5/weather?q=${cityInput}&appid=${apiKey}&units=metric`;

            const errorElement = document.getElementById('error');
            const weatherInfoElement = document.getElementById('weatherInfo');
            const loadingElement = document.getElementById('loading');
            const alertElement = document.getElementById('weatherAlert');

            errorElement.classList.remove('show');
            weatherInfoElement.classList.remove('show');
            alertElement.classList.remove('show');
            loadingElement.classList.add('show');

            if (!cityInput && !lat && !lon) {
                errorElement.textContent = translations[currentLanguage].error || 'Please enter a city name or allow location access.';
                errorElement.classList.add('show');
                loadingElement.classList.remove('show');
                return null;
            }

            try {
                const response = await fetch(url);
                if (!response.ok) {
                    const errorData = await response.json();
                    if (response.status === 401) throw new Error('Invalid API key.');
                    if (response.status === 404) throw new Error('City not found.');
                    if (response.status === 429) throw new Error('API rate limit exceeded.');
                    throw new Error(`API error: ${errorData.message || 'Unknown error'}`);
                }

                const data = await response.json();
                document.getElementById('cityName').textContent = `${data.name}, ${data.sys.country}`;
                document.getElementById('weatherIcon').src = `https://openweathermap.org/img/wn/${data.weather[0].icon}@2x.png`;
                document.getElementById('tempValue').textContent = `${data.main.temp}┬░C`;
                document.getElementById('description').textContent = `Weather: ${data.weather[0].description}`; // Note: API data remains in English
                document.getElementById('humidityValue').textContent = `${data.main.humidity}%`;
                document.getElementById('windValue').textContent = `${data.wind.speed} m/s`;

                let alertMessage = '';
                if (data.main.temp > 40) alertMessage = 'тЪая╕П Extreme Heat Warning: Temperature exceeds 40┬░C!';
                else if (data.main.temp < 0) alertMessage = 'тЪая╕П Freezing Warning: Temperature below 0┬░C!';
                else if (data.wind.speed > 15) alertMessage = 'тЪая╕П High Wind Warning: Wind speed exceeds 15 m/s!';
                if (alertMessage) {
                    alertElement.textContent = alertMessage; // Alerts remain in English for simplicity
                    alertElement.classList.add('show');
                }

                weatherInfoElement.classList.add('show');
                loadingElement.classList.remove('show');

                await getForecast(data.name);
                return data;
            } catch (error) {
                errorElement.textContent = error.message;
                errorElement.classList.add('show');
                loadingElement.classList.remove('show');
                document.getElementById('cityInput').value = '';
                return null;
            }
        }

        async function getForecast(city) {
            const apiKey = 'bd5e378503939ddaee76f12ad7a97608';
            const url = `https://api.openweathermap.org/data/2.5/forecast?q=${city}&appid=${apiKey}&units=metric`;
            const forecastContainer = document.getElementById('forecastContainer');
            forecastContainer.innerHTML = '';

            try {
                const response = await fetch(url);
                if (!response.ok) throw new Error('Unable to fetch forecast.');

                const data = await response.json();
                const dailyData = [];
                const temperatures = [];
                const dates = [];

                for (let i = 0; i < data.list.length; i += 8) {
                    const entry = data.list[i];
                    const date = new Date(entry.dt * 1000).toLocaleDateString(currentLanguage === 'en' ? 'en-US' : currentLanguage, { weekday: 'short', month: 'short', day: 'numeric' });
                    dailyData.push({
                        date: date,
                        temp: entry.main.temp,
                        icon: entry.weather[0].icon,
                        description: entry.weather[0].description
                    });
                    temperatures.push(entry.main.temp);
                    dates.push(date);
                }

                dailyData.forEach(day => {
                    const forecastCard = document.createElement('div');
                    forecastCard.classList.add('forecast-card');
                    forecastCard.innerHTML = `
                        <h4>${day.date}</h4>
                        <img src="https://openweathermap.org/img/wn/${day.icon}.png" alt="Weather Icon">
                        <p>${day.temp}┬░C</p>
                        <p>${day.description}</p>
                    `;
                    forecastContainer.appendChild(forecastCard);
                });

                updateTemperatureChart(dates, temperatures);
            } catch (error) {
                console.error('Error fetching forecast:', error);
            }
        }

        function updateTemperatureChart(dates, temperatures) {
            const ctx = document.getElementById('tempChart').getContext('2d');
            const isDarkMode = document.body.classList.contains('dark-mode');

            if (tempChart) tempChart.destroy();

            tempChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: dates,
                    datasets: [{
                        label: translations[currentLanguage].temperatureLabel + ' (┬░C)',
                        data: temperatures,
                        borderColor: isDarkMode ? '#b565d9' : '#4a90e2',
                        backgroundColor: isDarkMode ? 'rgba(181, 101, 217, 0.2)' : 'rgba(74, 144, 226, 0.2)',
                        fill: true,
                        tension: 0.4
                    }]
                },
                options: {
                    plugins: {
                        title: {
                            display: true,
                            text: translations[currentLanguage].chartTitle,
                            color: isDarkMode ? '#ddd' : '#333'
                        },
                        legend: {
                            labels: {
                                color: isDarkMode ? '#ddd' : '#333'
                            }
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: false,
                            title: {
                                display: true,
                                text: translations[currentLanguage].temperatureLabel + ' (┬░C)',
                                color: isDarkMode ? '#ddd' : '#333'
                            },
                            ticks: {
                                color: isDarkMode ? '#ddd' : '#333'
                            },
                            grid: {
                                color: isDarkMode ? 'rgba(255, 255, 255, 0.1)' : 'rgba(0, 0, 0, 0.1)'
                            }
                        },
                        x: {
                            title: {
                                display: true,
                                text: 'Date',
                                color: isDarkMode ? '#ddd' : '#333'
                            },
                            ticks: {
                                color: isDarkMode ? '#ddd' : '#333'
                            },
                            grid: {
                                color: isDarkMode ? 'rgba(255, 255, 255, 0.1)' : 'rgba(0, 0, 0, 0.1)'
                            }
                        }
                    }
                }
            });
        }

        function updateChartTheme() {
            const weatherInfoElement = document.getElementById('weatherInfo');
            if (weatherInfoElement.classList.contains('show')) {
                const city = document.getElementById('cityName').textContent.split(',')[0];
                getForecast(city);
            }
        }

        function getWeatherByLocation() {
            if (navigator.geolocation) {
                navigator.geolocation.getCurrentPosition(
                    (position) => {
                        const lat = position.coords.latitude;
                        const lon = position.coords.longitude;
                        getWeather(null, lat, lon);
                    },
                    (error) => {
                        const errorElement = document.getElementById('error');
                        errorElement.textContent = 'Unable to access location. Please enter a city name.';
                        errorElement.classList.add('show');
                        document.getElementById('loading').classList.remove('show');
                    }
                );
            } else {
                const errorElement = document.getElementById('error');
                errorElement.textContent = 'Geolocation is not supported by your browser.';
                errorElement.classList.add('show');
                document.getElementById('loading').classList.remove('show');
            }
        }

        document.getElementById('cityInput').addEventListener('keypress', function (e) {
            if (e.key === 'Enter') {
                getWeather();
            }
        });

        function toggleChatbot() {
            const chatbotWindow = document.getElementById('chatbotWindow');
            chatbotWindow.classList.toggle('show');
            if (chatbotWindow.classList.contains('show')) {
                document.getElementById('chatbotMessages').innerHTML = `<div class="message bot-message" data-translate="chatbotWelcome">${translations[currentLanguage].chatbotWelcome}</div>`;
            }
        }

        function addMessage(content, isBot = false) {
            const messagesContainer = document.getElementById('chatbotMessages');
            const messageDiv = document.createElement('div');
            messageDiv.classList.add('message');
            messageDiv.classList.add(isBot ? 'bot-message' : 'user-message');
            messageDiv.textContent = content;
            messagesContainer.appendChild(messageDiv);
            messagesContainer.scrollTop = messagesContainer.scrollHeight;
        }

        async function sendMessage() {
            const input = document.getElementById('chatbotInput');
            const userMessage = input.value.trim().toLowerCase();
            if (!userMessage) return;

            addMessage(userMessage, false);
            input.value = '';

            if (userMessage.includes('how do i use') || userMessage.includes('help')) {
                addMessage(translations[currentLanguage].chatbotHelp, true);
            } else if (userMessage.includes('what data') || userMessage.includes('what information')) {
                addMessage(translations[currentLanguage].chatbotData, true);
            } else if (userMessage.includes('weather in')) {
                const cityMatch = userMessage.match(/weather in ([\w\s]+)/);
                if (cityMatch && cityMatch[1]) {
                    const city = cityMatch[1].trim();
                    addMessage(translations[currentLanguage].chatbotFetching.replace('{city}', city), true);
                    const weatherData = await getWeather(city);
                    if (weatherData) {
                        const message = translations[currentLanguage].chatbotWeather
                            .replace('{city}', weatherData.name)
                            .replace('{country}', weatherData.sys.country)
                            .replace('{description}', weatherData.weather[0].description)
                            .replace('{temp}', weatherData.main.temp)
                            .replace('{humidity}', weatherData.main.humidity)
                            .replace('{wind}', weatherData.wind.speed);
                        addMessage(message, true);
                    } else {
                        const suggestions = suggestCities(city);
                        const message = translations[currentLanguage].chatbotNotFound
                            .replace('{city}', city)
                            .replace('{suggestions}', suggestions.join(', '));
                        addMessage(message, true);
                    }
                } else {
                    addMessage(translations[currentLanguage].chatbotSpecifyCity, true);
                }
            } else if (userMessage.includes('hi') || userMessage.includes('hello')) {
                addMessage(translations[currentLanguage].chatbotHello, true);
            } else if (userMessage.includes('temperature unit')) {
                addMessage(translations[currentLanguage].chatbotTempUnit, true);
            } else if (userMessage.includes('forecast')) {
                addMessage(translations[currentLanguage].chatbotForecast, true);
            } else if (userMessage.includes('dark mode')) {
                addMessage(translations[currentLanguage].chatbotDarkMode, true);
            } else if (userMessage.includes('my location')) {
                addMessage(translations[currentLanguage].chatbotMyLocation, true);
            } else {
                addMessage(translations[currentLanguage].chatbotUnknown, true);
            }
        }

        function suggestCities(city) {
            const cityMap = {
                'lndon': 'London',
                'paris': 'Paris',
                'new yrok': 'New York',
                'tokoyo': 'Tokyo',
                'mumbay': 'Mumbai',
                'sidney': 'Sydney'
            };
            const suggestions = [];
            const cityLower = city.toLowerCase();
            for (const key in cityMap) {
                if (key.includes(cityLower) || cityLower.includes(key)) {
                    suggestions.push(cityMap[key]);
                }
            }
            return suggestions.length ? suggestions : ['London', 'Paris', 'New York'];
        }
    </script>
</body>
</html>